<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MoonFund</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    button { padding: 10px 20px; margin: 5px 0; width: 100%; }
    #status { margin-top: 15px; white-space: pre-line; }
  </style>
</head>
<body>
  <h1>MoonFund</h1>
  <button id="connect">Connect Wallet</button>
  <button id="donate">Donate 1 USDC</button>
  <button id="withdraw">Withdraw (Creator)</button>
  <button id="refund">Claim Refund</button>
  <div id="status">Status: Not connected</div>

  <!-- Load ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

  <script>
    const contractAddress = "0x9BF0898b74Dd8535cCae7dc5D2404d25a382758A";
    const abi = [
      // Paste your full ABI here (same as the one you gave me)
      {"inputs":[{"internalType":"address","name":"_creator","type":"address"},{"internalType":"address","name":"_usdc","type":"address"},{"internalType":"uint256","name":"_goal","type":"uint256"},{"internalType":"uint256","name":"_days","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},
      {"inputs":[],"name":"AlreadyUnlocked","type":"error"},
      {"inputs":[],"name":"DeadlineActive","type":"error"},
      {"inputs":[],"name":"DelayNotElapsed","type":"error"},
      {"inputs":[],"name":"GoalNotReached","type":"error"},
      {"inputs":[],"name":"InsufficientAllowance","type":"error"},
      {"inputs":[],"name":"InvalidCreator","type":"error"},
      {"inputs":[],"name":"InvalidToken","type":"error"},
      {"inputs":[],"name":"NoContribution","type":"error"},
      {"inputs":[],"name":"TransferFailed","type":"error"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"donor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Donated","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"total","type":"uint256"}],"name":"GoalReached","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"donor","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Refunded","type":"event"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"creator","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Withdrawn","type":"event"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"contributions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"creator","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"deadline","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"donate","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"goal","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"progress","outputs":[{"internalType":"uint256","name":"raised_","type":"uint256"},{"internalType":"uint256","name":"goal_","type":"uint256"},{"internalType":"bool","name":"unlocked_","type":"bool"},{"internalType":"uint256","name":"timeLeft_","type":"uint256"},{"internalType":"uint256","name":"timeUntilWithdraw_","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"raised","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"refund","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"unlockDelay","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"unlockTimestamp","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"unlocked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"usdc","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}
    ];

    let provider, signer, contract, userAddress;

    document.getElementById("withdraw").style.display = "none";
    document.getElementById("refund").style.display = "none";

    async function connectWallet() {
      try {
        if (!window.ethereum) { alert("MetaMask not detected!"); return; }
        provider = new window.ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        contract = new window.ethers.Contract(contractAddress, abi, signer);
        document.getElementById("status").innerText = "Wallet connected: " + userAddress;

        const creator = await contract.creator();
        if (creator.toLowerCase() === userAddress.toLowerCase()) {
          document.getElementById("withdraw").style.display = "block";
        }

        const contribution = await contract.contributions(userAddress);
        const progressData = await contract.progress();
        const unlocked = progressData.unlocked_;
        if (contribution > 0 && !unlocked) {
          document.getElementById("refund").style.display = "block";
        }

      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Error connecting wallet: " + err.message;
      }
    }

    async function donate() {
      if (!contract) return alert("Connect wallet first");
      try {
        const tx = await contract.donate(1000000); // 1 USDC = 1e6
        await tx.wait();
        document.getElementById("status").innerText = "Donation sent!";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Donation error: " + err.message;
      }
    }

    async function withdraw() {
      if (!contract) return alert("Connect wallet first");
      try {
        const tx = await contract.withdraw();
        await tx.wait();
        document.getElementById("status").innerText = "Withdrawn successfully!";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Withdraw error: " + err.message;
      }
    }

    async function refund() {
      if (!contract) return alert("Connect wallet first");
      try {
        const tx = await contract.refund();
        await tx.wait();
        document.getElementById("status").innerText = "Refund claimed!";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "Refund error: " + err.message;
      }
    }

    document.getElementById("connect").onclick = connectWallet;
    document.getElementById("donate").onclick = donate;
    document.getElementById("withdraw").onclick = withdraw;
    document.getElementById("refund").onclick = refund;

  </script>
</body>
</html>
